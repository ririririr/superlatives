{% extends "base.html" %}

{% block title %}Superlatives | All Votings{% endblock %}

{% block content %}
<section class="card">
  <header class="card-header">
    <div>
      <h1>All Votings</h1>
      <p class="lead">
        Explore live superlative polls. Create a new voting or cast your voice in existing ones.
      </p>
    </div>
    <form method="get" class="sort-form">
      <label for="sort">Sort by</label>
      <select id="sort" name="sort" onchange="this.form.submit()">
        <option value="recent" {% if sort_choice == 'recent' %}selected{% endif %}>Newest first</option>
        <option value="popular" {% if sort_choice == 'popular' %}selected{% endif %}>Most participants</option>
      </select>
    </form>
  </header>
  {% if polls %}
  <ul class="poll-list">
    {% for entry in polls %}
    {% set poll = entry.poll %}
    <li class="poll-item">
      {% if poll.cover_image %}
      <img
        class="poll-cover"
        src="{{ url_for('static', filename=poll.cover_image) }}"
        alt="Cover image for {{ poll.title }}"
      />
      {% endif %}
      <h2>{{ poll.title }}</h2>
      {% if poll.description %}
      <p class="poll-description">{{ poll.description }}</p>
      {% endif %}
      <div class="poll-meta">
        <span>Created by {{ poll.creator.name }}</span>
        <span>Released {{ poll.created_at.strftime("%b %d, %Y %I:%M %p") }}</span>
      </div>
      <div class="poll-stats">
        <span>{{ entry.vote_count }} participant{% if entry.vote_count != 1 %}s{% endif %}</span>
        <span>{{ poll.options|length }} categories</span>
        <span>Chat {{ 'enabled' if poll.chat_enabled else 'disabled' }}</span>
      </div>
      <a class="button" href="{{ url_for('poll_detail', poll_id=poll.id) }}">Go to voting</a>
    </li>
    {% endfor %}
  </ul>
  {% else %}
  {% if current_user %}
  <p>No votings from others yet. Encourage your classmates to launch one!</p>
  {% else %}
  <p>No votings yet. Be the trailblazer!</p>
  {% endif %}
  {% endif %}
  {% if pagination.has_next %}
  <div class="pagination">
    <a
      class="button secondary"
      href="{{ url_for('index', sort=sort_choice, page=pagination.next_num) }}"
    >
      Load more
    </a>
  </div>
  {% endif %}
</section>
{% endblock %}
